id: zscaler
metric_id: z-scaler
backend_only: false
facets:
  - groups:
      - Event
    name: Event Outcome
    path: evt.outcome
    source: log
  - groups:
      - Web Access
    name: Method
    path: http.method
    source: log
  - groups:
      - Web Access
    name: Referer
    path: http.referer
    source: log
  - groups:
      - Web Access
    name: Status Code
    path: http.status_code
    source: log
  - groups:
      - Web Access
    name: URL Path
    path: http.url
    source: log
  - groups:
      - Web Access
    name: URL Host
    path: http.url_details.host
    source: log
  - groups:
      - Web Access
    name: URL Path
    path: http.url_details.path
    source: log
  - groups:
      - Web Access
    name: URL Port
    path: http.url_details.port
    source: log
  - groups:
      - Web Access
    name: URL scheme
    path: http.url_details.scheme
    source: log
  - groups:
      - Web Access
    name: User-Agent
    path: http.useragent
    source: log
  - groups:
      - Web Access
    name: Browser
    path: http.useragent_details.browser.family
    source: log
  - groups:
      - Web Access
    name: Device
    path: http.useragent_details.device.family
    source: log
  - groups:
      - Web Access
    name: OS
    path: http.useragent_details.os.family
    source: log
  - groups:
      - Geoip
    name: City Name
    path: network.client.geoip.city.name
    source: log
  - groups:
      - Geoip
    name: Continent Code
    path: network.client.geoip.continent.code
    source: log
  - groups:
      - Geoip
    name: Continent Name
    path: network.client.geoip.continent.name
    source: log
  - groups:
      - Geoip
    name: Country ISO Code
    path: network.client.geoip.country.iso_code
    source: log
  - groups:
      - Geoip
    name: Country Name
    path: network.client.geoip.country.name
    source: log
  - groups:
      - Geoip
    name: Subdivision ISO Code
    path: network.client.geoip.subdivision.iso_code
    source: log
  - groups:
      - Geoip
    name: Subdivision Name
    path: network.client.geoip.subdivision.name
    source: log
  - groups:
      - Web Access
    name: Client IP
    path: network.client.ip
    source: log
  - groups:
      - Web Access
    name: Client Port
    path: network.client.port
    source: log
  - groups:
      - Geoip
    name: Destination City Name
    path: network.destination.geoip.city.name
    source: log
  - groups:
      - Geoip
    name: Destination Continent Code
    path: network.destination.geoip.continent.code
    source: log
  - groups:
      - Geoip
    name: Destination Continent Name
    path: network.destination.geoip.continent.name
    source: log
  - groups:
      - Geoip
    name: Destination Country ISO Code
    path: network.destination.geoip.country.iso_code
    source: log
  - groups:
      - Geoip
    name: Destination Country Name
    path: network.destination.geoip.country.name
    source: log
  - groups:
      - Geoip
    name: Destination Subdivision ISO Code
    path: network.destination.geoip.subdivision.iso_code
    source: log
  - groups:
      - Geoip
    name: Destination Subdivision Name
    path: network.destination.geoip.subdivision.name
    source: log
  - groups:
      - Web Access
    name: Destination IP
    path: network.destination.ip
    source: log
  - groups:
      - Web Access
    name: Destination Port
    path: network.destination.port
    source: log
  - groups:
      - User
    name: User ID
    path: usr.id
    source: log
  - groups:
      - zscaler
    name: Zscaler odevicehostname
    path: zscaler.odevicehostname
    source: log
  - groups:
      - zscaler
    name: Zscaler Threat Class
    path: zscaler.threatclass
    source: log
  - groups:
      - zscaler
    name: Zscaler Protocol
    path: zscaler.protocol
    source: log
  - groups:
      - zscaler
    name: Zscaler Response Size
    path: zscaler.responsesize
    source: log
  - groups:
      - zscaler
    name: Zscaler Request Rule Label
    path: zscaler.reqrulelabel
    source: log
  - groups:
      - zscaler
    name: Zscaler Request Size
    path: zscaler.requestsize
    source: log
  - groups:
      - zscaler
    name: File Type
    path: zscaler.filetype
    source: log
  - groups:
      - zscaler
    name: Zscaler Reason
    path: zscaler.reason
    source: log
  - groups:
      - zscaler
    name: Zscaler IP Category
    path: zscaler.ipcat
    source: log
  - groups:
      - zscaler
    name: Zscaler App Claass
    path: zscaler.appclass
    source: log
  - groups:
      - zscaler
    name: DNS Request Type
    path: zscaler.dns_reqtype
    source: log
  - groups:
      - Geoip
    name: network.client.geoip.as.type
    path: network.client.geoip.as.type
    source: log
  - groups:
      - zscaler
    name: zscaler.appname
    path: zscaler.appname
    source: log
  - groups:
      - Web Access
    name: http.useragent_details.device.category
    path: http.useragent_details.device.category
    source: log
  - groups:
      - zscaler
    name: Zscaler Response Action
    path: zscaler.resaction
    source: log
  - groups:
      - zscaler
    name: Zscaler Response Rule Lable
    path: zscaler.resrulelabel
    source: log
  - groups:
      - zscaler
    name: Zscaler Category
    path: zscaler.category
    source: log
  - groups:
      - zscaler
    name: Zscaler Threat Name
    path: zscaler.threatname
    source: log
  - groups:
      - zscaler
    name: Zscaler Content Type
    path: zscaler.contenttype
    source: log
  - groups:
      - zscaler
    name: Zscaler Record Type
    path: zscaler.Recordtype
    source: log
  - groups:
      - zscaler
    name: DNS Request
    path: zscaler.dns_req
    source: log
  - groups:
      - zscaler
    name: Zscaler odeviceowner
    path: zscaler.odeviceowner
    source: log
  - groups:
      - zscaler
    name: Zscaler Tunnel Type
    path: zscaler.tunneltype
    source: log
  - groups:
      - zscaler
    name: Zscaler Department
    path: zscaler.department
    source: log
pipeline:
  type: pipeline
  name: Zscaler
  enabled: true
  filter:
    query: source:zscaler
  processors:
    - type: attribute-remapper
      name: Map `event` to `zscaler`
      enabled: true
      sources:
        - event
      sourceType: attribute
      target: zscaler
      targetType: attribute
      preserveSource: false
      overrideOnConflict: false
    - type: attribute-remapper
      name: Map `zscaler.sourceip`, `zscaler.clientpublicIP`, `zscaler.cdip` to `network.client.ip`
      enabled: true
      sources:
        - zscaler.sourceip
        - zscaler.clientpublicIP
        - zscaler.cdip
      sourceType: attribute
      target: network.client.ip
      targetType: attribute
      preserveSource: true
      overrideOnConflict: false
    - type: attribute-remapper
      name: Map `zscaler.destinationip`, `zscaler.sdip`, `zscaler.dns_resp`, `zscaler.serverip` to `network.destination.ip`
      enabled: true
      sources:
        - zscaler.destinationip
        - zscaler.sdip
        - zscaler.dns_resp
        - zscaler.serverip
      sourceType: attribute
      target: network.destination.ip
      targetType: attribute
      preserveSource: true
      overrideOnConflict: false
    - type: attribute-remapper
      name: Map `zscaler.user` to `usr.id`
      enabled: true
      sources:
        - zscaler.user
      sourceType: attribute
      target: usr.id
      targetType: attribute
      preserveSource: true
      overrideOnConflict: false
    - type: attribute-remapper
      name: Map `zscaler.sourceport` to `network.client.port`
      enabled: true
      sources:
        - zscaler.sourceport
      sourceType: attribute
      target: network.client.port
      targetType: attribute
      preserveSource: true
      overrideOnConflict: false
    - type: geo-ip-parser
      name: Client IP
      enabled: true
      sources:
        - network.client.ip
      target: network.client.geoip
    - type: geo-ip-parser
      name: Destination IP
      enabled: true
      sources:
        - network.destination.ip
      target: network.destination.geoip
    - type: string-builder-processor
      name: Prepend protocol to URL
      enabled: true
      template: '%{zscaler.protocol}://%{zscaler.url}'
      target: zscaler.url_full
      replaceMissing: false
    - type: attribute-remapper
      name: Map `zscaler.url_full` to `http.url`
      enabled: true
      sources:
        - zscaler.url_full
      sourceType: attribute
      target: http.url
      targetType: attribute
      preserveSource: false
      overrideOnConflict: false
    - type: url-parser
      name: Url Parser
      enabled: true
      sources:
        - http.url
      target: http.url_details
      normalizeEndingSlashes: false
    - type: attribute-remapper
      name: Map `zscaler.useragent` to `http.useragent`
      enabled: true
      sources:
        - zscaler.useragent
      sourceType: attribute
      target: http.useragent
      targetType: attribute
      preserveSource: true
      overrideOnConflict: false
    - type: user-agent-parser
      name: HTTP User-Agent Parser
      enabled: true
      sources:
        - http.useragent
      target: http.useragent_details
      encoded: false
      combineVersionDetails: false
    - type: attribute-remapper
      name: Map `zscaler.requestmethod` to `http.method`
      enabled: true
      sources:
        - zscaler.requestmethod
      sourceType: attribute
      target: http.method
      targetType: attribute
      preserveSource: true
      overrideOnConflict: false
    - type: attribute-remapper
      name: Map `zscaler.status` to `http.status_code`
      enabled: true
      sources:
        - zscaler.status
      sourceType: attribute
      target: http.status_code
      targetType: attribute
      preserveSource: true
      overrideOnConflict: true
    - type: attribute-remapper
      name: Map `zscaler.refererURL` to `http.referer`
      enabled: true
      sources:
        - zscaler.refererURL
      sourceType: attribute
      target: http.referer
      targetType: attribute
      preserveSource: true
      overrideOnConflict: false
    - type: geo-ip-parser
      name: Destination IP
      enabled: true
      sources:
        - network.destination.ip
      target: network.destination.geoip
    - type: attribute-remapper
      name: Map `zscaler.action` to `evt.outcome`
      enabled: true
      sources:
        - zscaler.action
      sourceType: attribute
      target: evt.outcome
      targetType: attribute
      preserveSource: true
      overrideOnConflict: false
    - type: attribute-remapper
      name: Map `zscaler.inbytes` to `network.bytes_read`
      enabled: true
      sources:
        - zscaler.inbytes
      sourceType: attribute
      target: network.bytes_read
      targetType: attribute
      preserveSource: true
      overrideOnConflict: false
    - type: attribute-remapper
      name: Map `zscaler.outbytes` to `network.bytes_written`
      enabled: true
      sources:
        - zscaler.outbytes
      sourceType: attribute
      target: network.bytes_written
      targetType: attribute
      preserveSource: true
      overrideOnConflict: false
    - type: attribute-remapper
      name: Map `zscaler.sdport`, `zscaler.srv_dport` to `network.destination.port`
      enabled: true
      sources:
        - zscaler.sdport
        - zscaler.srv_dport
      sourceType: attribute
      target: network.destination.port
      targetType: attribute
      preserveSource: true
      overrideOnConflict: false
    - type: attribute-remapper
      name: Map `zscaler.ssport` to `network.client.port`
      enabled: true
      sources:
        - zscaler.ssport
      sourceType: attribute
      target: network.client.port
      targetType: attribute
      preserveSource: true
      overrideOnConflict: false
    - type: grok-parser
      name: Date
      enabled: true
      source: zscaler.datetime
      samples:
        - '2021-09-22 17:53:52'
        - Wed Sep 22 17:54:17 2021
      grok:
        supportRules: ''
        matchRules: |-
          date_1 %{date("yyyy-MM-dd HH:mm:ss"):date}
          date_2 %{date("EEE MMM dd HH:mm:ss yyyy"):date}
    - type: date-remapper
      name: Define `date` as the official date of the log
      enabled: true
      sources:
        - date
