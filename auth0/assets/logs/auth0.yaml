id: auth0
metric_id: auth0
backend_only: false
facets:
  - groups:
      - Event
    name: Event Name
    path: evt.name
    source: log
  - groups:
      - Event
    name: Event Outcome
    path: evt.outcome
    source: log
  - groups:
      - Web Access
    name: User-Agent
    path: http.useragent
    source: log
  - groups:
      - Web Access
    name: Browser
    path: http.useragent_details.browser.family
    source: log
  - groups:
      - Web Access
    name: Device
    path: http.useragent_details.device.family
    source: log
  - groups:
      - Web Access
    name: OS
    path: http.useragent_details.os.family
    source: log
  - groups:
      - Geoip
    name: City Name
    path: network.client.geoip.city.name
    source: log
  - groups:
      - Geoip
    name: Continent Code
    path: network.client.geoip.continent.code
    source: log
  - groups:
      - Geoip
    name: Continent Name
    path: network.client.geoip.continent.name
    source: log
  - groups:
      - Geoip
    name: Country ISO Code
    path: network.client.geoip.country.iso_code
    source: log
  - groups:
      - Geoip
    name: Country Name
    path: network.client.geoip.country.name
    source: log
  - groups:
      - Geoip
    name: Subdivision ISO Code
    path: network.client.geoip.subdivision.iso_code
    source: log
  - groups:
      - Geoip
    name: Subdivision Name
    path: network.client.geoip.subdivision.name
    source: log
  - groups:
      - Web Access
    name: Client IP
    path: network.client.ip
    source: log
  - groups:
      - User
    name: User Email
    path: usr.email
    source: log
  - groups:
      - User
    name: User ID
    path: usr.id
    source: log
  - groups:
      - User
    name: User Name
    path: usr.name
    source: log
  - groups:
      - Event
    name: Event Category
    path: evt.category
    source: log
  - groups:
      - Auth0
    name: Auth0 Event Code
    path: data.type
    source: log
  - groups:
      - Auth0
    name: Target App
    path: data.client_name
    source: log
  - groups:
      - Auth0
    name: Target Hostname
    path: data.hostname
    source: log
pipeline:
  type: pipeline
  name: Auth0
  enabled: true
  filter:
    query: source:auth0
  processors:
    - type: date-remapper
      name: Define `data.date` as the official date of the log
      enabled: true
      sources:
        - data.date
    - type: attribute-remapper
      name: Map `data.ip` to `network.client.ip`
      enabled: true
      sources:
        - data.ip
      target: network.client.ip
      preserveSource: true
      overrideOnConflict: false
      sourceType: attribute
      targetType: attribute
    - type: geo-ip-parser
      name: Fetching GeoIp data for client ip
      enabled: true
      sources:
        - network.client.ip
      target: network.client.geoip
    - type: attribute-remapper
      name: Map `data.user_agent` to `http.useragent`
      enabled: true
      sources:
        - data.user_agent
      target: http.useragent
      preserveSource: true
      overrideOnConflict: false
      sourceType: attribute
      targetType: attribute
    - type: user-agent-parser
      name: ""
      enabled: true
      sources:
        - http.useragent
      target: http.useragent_details
      encoded: false
    - type: attribute-remapper
      name: Map `data.user_id` to `usr.id`
      enabled: true
      sources:
        - data.user_id
      target: usr.id
      preserveSource: true
      overrideOnConflict: false
      sourceType: attribute
      targetType: attribute
    - type: attribute-remapper
      name: Map `data.user_name` to `usr.name`
      enabled: true
      sources:
        - data.user_name
      target: usr.name
      preserveSource: true
      overrideOnConflict: false
      sourceType: attribute
      targetType: attribute
    - type: attribute-remapper
      name: Map `data.details.request.auth.user.email` to `usr.email`
      enabled: true
      sources:
        - data.details.request.auth.user.email
      target: usr.email
      preserveSource: false
      overrideOnConflict: false
      sourceType: attribute
      targetType: attribute
    - type: lookup-processor
      name: Map data.type to evt.name
      enabled: true
      source: data.type
      target: evt.name
      lookupTable: "admin_update_launch,auth0_update_launched\napi_limit,rate_limit_on_the_authentication_api\ncls,code_or_link_sent\ncoff,connector_offline\ncon,connector_online\ncs,code_sent\ndepnote,deprecation_notice\ndu,deleted_user\nf,failed_login\nfapi,failed_api_operation\nfc,failed_by_connector\nfce,failed_change_email\nfco,failed_by_cors\nfcoa,failed_cross-origin_authentication\nfcp,failed_change_password\nfcph,failed_post_change_password_hook\nfcpn,failed_change_phone_number\nfcpr,failed_change_password_request\nfcpro,failed_connector_provisioning\nfcu,failed_change_username\nfd,failed_delegation\nfdeac,failed_device_activation\nfdeaz,failed_device_authorization_request\nfdecc,user_canceled_device_confirmation\nfdu,failed_user_deletion\nfeacft,failed_exchange_authorization_code_for_access_token\nfeccft,failed_exchange_access_token_for_client_credentials_grant\nfede,failed_exchange_device_code_for_access_token\nfens,failed_exchange_for_native_social_login\nfeoobft,failed_exchange_password_and_oob_challenge_for_access_token\nfeotpft,failed_exchange_password_and_otp_challege_for_access_token\nfepft,failed_exchange_password_for_access_token\nfercft,failed_exchange_password_and_mfa_recovery_code_for_access_token\nfertft,failed_exchange_refresh_token_for_access_token\nferrt,failed_exchange_rotating_refresh_token\nflo,failed_logout\nfn,failed_sending_notification\nfp,failed_login_incorrect_password\nfs,failed_signup\nfsa,failed_silent_auth\nfu,failed_login_invalid_email_or_username\nfui,failed_users_import\nfv,failed_verification_email\nfvr,failed_verification_email_request\ngd_auth_failed,multifactor_auth_failed\ngd_auth_rejected,multifactor_auth_rejected\ngd_auth_succeed,multifactor_auth_success\ngd_enrollment_complete,multifactor_enrollment_complete\ngd_module_switch,multifactor_module_switch\ngd_otp_rate_limit_exceed,multifactor_too_many_failures\ngd_recovery_failed,multifactor_recovery_failed\ngd_recovery_rate_limit_exceed,multifactor_too_many_recovery_failures\ngd_recovery_succeed,multifactor_recovery_success\ngd_send_pn,multifactor_push_notification_sent\ngd_send_sms,multifactor_sms_sent\ngd_start_auth,multifactor_auth_started\ngd_start_enroll,multifactor_enroll_started\ngd_tenant_update,guardian_tenant_update\ngd_unenroll,multifactor_unenroll_device_account\ngd_update_device_account,multifactor_update_device_account\ngd_user_delete,multifactor_user_delete\nlimit_delegation,too_many_calls_to_delegation\nlimit_mu,blocked_ip_address\nlimit_wc,blocked_account\nmgmt_api_read,management_api_read_operation\npla,pre_login_assesment\npwd_leak,breached_password\nresource_cleanup,refresh_token_excess_warning\ns,success_login\nsapi,success_api_operation\nsce,success_change_email\nscoa,success_cross-origin_authentication\nscp,success_change_password\nscph,success_post_change_password_hook\nscpn,success_change_phone_number\nscpr,success_change_password_request\nscu,success_change_username\nsd,success_delegation\nsdu,success_user_deletion\nseacft,success_exchange_authorization_code\nseccft,success_exchange_client_credentials_grant\nsede,success_exchange_device_code\nsens,success_exchange_for_native_social_login\nseoobft,success_exchange_password_and_oob_challenge\nseotpft,success_exchange_password_and_otp_challege\nsepft,success_exchange_password\nsercft,success_exchange_password_and_mfa_recovery_code\nsertft,success_exchange_refresh_token\nsrrt,success_revocation\nslo,success_logout\nss,success_signup\nssa,success_silent_auth\nsui,success_users_import\nsv,success_verification_email\nsvr,success_verification_email_request\nsys_os_update_end,auth0_os_update_ended\nsys_os_update_start,auth0_os_update_started\nsys_update_end,auth0_update_ended\nsys_update_start,auth0_update_started\nublkdu,user_login_block_released\nw,warnings_during_login"
      defaultLookup: type_unknown
    - type: lookup-processor
      name: Map data.type to message
      enabled: true
      source: data.type
      target: message
      lookupTable: "api_limit, The maximum number of requests to the Authentication API in given time has reached.\ncls, Passwordless login code/link has been sent\ncoff, AD/LDAP Connector is offline \ncon, AD/LDAP Connector is online and working\ncs, Passwordless login code has been sent\ndu, User has been deleted.\nfce, Failed to change user email\nfco, Origin is not in the Allowed Origins list for the specified application\nfcpro, Failed to provision a AD/LDAP connector\nfcu, Failed to change username\nfd, Failed to generate delegation token\nfdeac, Failed to activate device.\nfdeaz, Device authorization request failed.\nfdecc, User did not confirm device.\nfeacft, Failed to exchange authorization code for Access Token\nfeccft, Failed exchange of Access Token for a Client Credentials Grant\nfede, Failed to exchange Device Code for Access Token\nfens, Failed exchange for Native Social Login\nfeoobft, Failed exchange of Password and OOB Challenge for Access Token\nfeotpft, Failed exchange of Password and OTP Challenge for Access Token\nfepft,Failed exchange of Password for Access Token\nfercft, Failed Exchange of Password and MFA Recovery code for Access Token\nfertft, Failed Exchange of Refresh Token for Access Token\nferrt, Failed Exchange of Rotating Refresh Token.\nflo, User logout failed\nfn, Failed to send email notification\nfui, Failed to import users\nfv, Failed to send verification email\nfvr, Failed to process verification email request\ngd_auth_failed, One-time password authentication failed.\ngd_auth_rejected, One-time password authentication rejected.\ngd_auth_succeed, One-time password authentication success.\ngd_recovery_failed, Multi-factor recovery code failed.\ngd_recovery_rate_limit_exceed, Multi-factor recovery code has failed too many times.\ngd_recovery_succeed, Multi-factor recovery code succeeded authorization.\ngd_send_pn, Push notification for MFA sent successfully sent.\ngd_send_sms, SMS for MFA sent successfully sent.\ngd_start_auth, Second factor authentication event started for MFA.\ngd_start_enroll, Multi-factor authentication enroll has started.\ngd_unenroll, Device used for second factor authentication has been unenrolled.\ngd_update_device_account, Device used for second factor authentication has been updated.\ngd_user_delete, Deleted multi-factor user account.\nlimit_delegation, Rate limit exceeded to /delegation endpoint\nlimit_mu, An IP address is blocked with 100 failed login attempts using different usernames all with incorrect passwords in 24 hours or 50 sign-up attempts per minute from the same IP address.\nlimit_wc, An IP address is blocked with 10 failed login attempts into a single account from the same IP address.\nmgmt_api_read, API GET operation returning secrets completed successfully\npla, This log is generated before a login and helps in monitoring the behavior of bot detection without having to enable it.\npwd_leak, Someone behind the IP address: ip attempted to login with a leaked password.\nresource_cleanup, Emitted when resources exceeding defined limits were removed.\ns, Successful login event.\nsdu, User successfully deleted\nseacft, Successful exchange of authorization code for Access Token\nseccft, Successful exchange of Access Token for a Client Credentials Grant\nsede, Successful exchange of device code for Access Token\nsens, Native Social Login\nseoobft, Successful exchange of Password and OOB Challenge for Access Token\nseotpft, Successful exchange of Password and OTP Challenge for Access Token\nsepft, Successful exchange of Password for Access Token\nsercft, Successful exchange of Password and MFA Recovery code for Access Token\nsertft, Successful exchange of Refresh Token for Access Token\nslo, User successfully logged out\nsrrt, Successfully revoked a Refresh Token\nss, Successful Signup\nsui, Successfully imported users\nublkdu, User block setup by anomaly detection has been released"
      defaultLookup:
    - type: category-processor
      name: Categorize authentication events
      enabled: true
      categories:
        - filter:
            query: "@evt.name:(success_login OR success_signup OR failed_login OR failed_signup OR failed_silent_auth OR failed_login_incorrect_password OR failed_login_invalid_email_or_username)"
          name: authentication
      target: evt.category
    - type: category-processor
      name: Categorize outcome of authentication events
      enabled: true
      categories:
        - filter:
            query: "@evt.name:(success_login OR success_signup)"
          name: success
        - filter:
            query: "@evt.name:(failed_login OR failed_signup OR failed_silent_auth OR failed_login_incorrect_password OR failed_login_invalid_email_or_username)"
          name: failure
      target: evt.outcome
    - type: message-remapper
      name: Define `message`, `data.description`, `evt.name` as the official message of the log
      enabled: true
      sources:
        - message
        - data.description
        - evt.name
    # OCSF transformations
    - type: pipeline
      name: OCSF pre transformations
      enabled: true
      ocsf:
        isOcsf: true
      filter:
        query: "*"
      processors:
        - type: attribute-remapper
          name: Map `data.log_id` to `ocsf.metadata.uid`
          enabled: true
          sources:
            - data.log_id
          sourceType: attribute
          target: ocsf.metadata.uid
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `data.date` to `ocsf.time_dt`
          enabled: true
          sources:
            - data.date
          sourceType: attribute
          target: ocsf.time_dt
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: grok-parser
          name: Parsing event time
          enabled: true
          source: ocsf.time_dt
          samples:
            - "2025-05-01T12:15:39.043474332Z"
            - "2025-05-01T12:15:39.04347433Z"
            - "2025-05-01T12:15:39.0434743Z"
          grok:
            supportRules: ""
            matchRules: |
              parsing_time %{date("yyyy-MM-dd'T'HH:mm:ss.SSSZ"):ocsf.time}
              parsing_time_1 %{date("yyyy-MM-dd'T'HH:mm:ss.SSSSSSSSSZ"):ocsf.time}
              parsing_time_2 %{date("yyyy-MM-dd'T'HH:mm:ss.SSSSSSSSZ"):ocsf.time}
              parsing_time_3 %{date("yyyy-MM-dd'T'HH:mm:ss.SSSSSSSZ"):ocsf.time}
              parsing_time_4 %{date("yyyy-MM-dd'T'HH:mm:ss.SSSSSSZ"):ocsf.time}
              parsing_time_5 %{date("yyyy-MM-dd'T'HH:mm:ss.SSSSSZ"):ocsf.time}
              parsing_time_6 %{date("yyyy-MM-dd'T'HH:mm:ss.SSSSZ"):ocsf.time}
              parsing_time_7 %{date("yyyy-MM-dd'T'HH:mm:ss.SSZ"):ocsf.time}
              parsing_time_8 %{date("yyyy-MM-dd'T'HH:mm:ssZ"):ocsf.time}
        - type: attribute-remapper
          name: Map `data.type` to `ocsf.metadata.event_code`
          enabled: true
          sources:
            - data.type
          sourceType: attribute
          target: ocsf.metadata.event_code
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: string-builder-processor
          name: Add version
          enabled: true
          template: "1.3.0"
          target: ocsf.metadata.version
          replaceMissing: false
        - type: attribute-remapper
          name: Map `data.$event_schema.version` to `ocsf.metadata.log_version`
          enabled: true
          sources:
            - data.$event_schema.version
          sourceType: attribute
          target: ocsf.metadata.log_version
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: string-builder-processor
          name: Add profiles
          enabled: true
          template: "[datetime]"
          target: ocsf.metadata.profiles
          replaceMissing: false
        - type: grok-parser
          name: Profiles string to array
          enabled: true
          source: ocsf.metadata.profiles
          samples:
            - "[date,time]"
          grok:
            supportRules: ""
            matchRules: ProfileStrToArray %{data:ocsf.metadata.profiles:array("[]",",")}
        - type: string-builder-processor
          name: Add product name
          enabled: true
          template: "Auth0"
          target: ocsf.metadata.product.name
          replaceMissing: false
        - type: string-builder-processor
          name: Add product vendor
          enabled: true
          template: "Auth0 Log Events"
          target: ocsf.metadata.product.vendor_name
          replaceMissing: false
        - type: string-builder-processor
          name: Add severity
          enabled: true
          template: "Informational"
          target: ocsf.severity
          replaceMissing: false
        - type: string-builder-processor
          name: Add severity id
          enabled: true
          template: "1"
          target: ocsf.severity_id
          replaceMissing: false
        - type: attribute-remapper
          name: Map `message` to `ocsf.message`
          enabled: true
          sources:
            - message
          sourceType: attribute
          target: ocsf.message
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `data.ip` to `ocsf.src_endpoint.ip`
          enabled: true
          sources:
            - data.ip
          sourceType: attribute
          target: ocsf.src_endpoint.ip
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `data.user_agent`, `data.details.request.userAgent` to `ocsf.http_request.user_agent`
          enabled: true
          sources:
            - data.user_agent
            - data.details.request.userAgent
          sourceType: attribute
          target: ocsf.http_request.user_agent
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `data.client_name` to `ocsf.actor.app_name`
          enabled: true
          sources:
            - data.client_name
          sourceType: attribute
          target: ocsf.actor.app_name
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `data.user_id` to `ocsf.actor.user.uid`
          enabled: true
          sources:
            - data.user_id
          sourceType: attribute
          target: ocsf.actor.user.uid
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `data.user_name` to `ocsf.actor.user.name`
          enabled: true
          sources:
            - data.user_name
          sourceType: attribute
          target: ocsf.actor.user.name
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `data.details.request.path` to `ocsf.http_request.url.path`
          enabled: true
          sources:
            - data.details.request.path
          sourceType: attribute
          target: ocsf.http_request.url.path
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: category-processor
          name: http_request.http_method
          enabled: true
          categories:
            - filter:
                query: "@data.details.request.method:(post OR POST)"
              name: "POST"
            - filter:
                query: "@data.details.request.method:(get OR GET)"
              name: "GET"
            - filter:
                query: "@data.details.request.method:(put OR PUT OR patch OR PATCH)"
              name: "PUT"
            - filter:
                query: "@data.details.request.method:(delete OR DELETE)"
              name: "DELETE"
            - filter:
                query: "@data.details.request.method:(options OR OPTIONS)"
              name: "OPTIONS"
            - filter:
                query: "@data.details.request.method:(head OR HEAD)"
              name: "HEAD"
            - filter:
                query: "@data.details.request.method:(trace OR TRACE)"
              name: "TRACE"
            - filter:
                query: "@data.details.request.method:(connect OR CONNECT)"
              name: "CONNECT"
          target: ocsf.http_request.http_method
    # OCSF Account Change [3001] pipeline
    - type: pipeline
      name: Auth0 OCSF sub pipeline for class Account Change [3001]
      enabled: true
      ocsf:
        isOcsf: true
      filter:
        query: "@ocsf.metadata.event_code:(fce OR fcp OR fcph OR fcpn OR fcpr OR fcu OR fdu OR gd_otp_rate_limit_exceed OR organization_member_added OR sce OR scp OR scpn OR scpr OR scu OR sdu)"
      processors:
        - type: attribute-remapper
          name: Map `data.type` to `ocsf.activity_name`
          enabled: true
          sources:
            - data.type
          sourceType: attribute
          target: ocsf.activity_name
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: category-processor
          name: activity_id
          enabled: true
          categories:
            - filter:
                query: "@ocsf.metadata.event_code:organization_member_added"
              name: "1"
            - filter:
                query: "@ocsf.metadata.event_code:(fcp OR fcpr OR scp OR scpr)"
              name: "3"
            - filter:
                query: "@ocsf.metadata.event_code:(fdu OR sdu)"
              name: "6"
            - filter:
                query: "@ocsf.metadata.event_code:*"
              name: "99"
          target: ocsf.activity_id
        - type: category-processor
          name: activity_name
          enabled: true
          categories:
            - filter:
                query: "@ocsf.metadata.event_code:organization_member_added"
              name: "Create"
            - filter:
                query: "@ocsf.metadata.event_code:(fcp OR fcpr OR scp OR scpr)"
              name: "Password Change"
            - filter:
                query: "@ocsf.metadata.event_code:(fdu OR sdu)"
              name: "Delete"
          target: ocsf.activity_name
        - type: attribute-remapper
          name: Map `ocsf.activity_id` to `ocsf.activity_id`
          enabled: true
          sources:
            - ocsf.activity_id
          sourceType: attribute
          target: ocsf.activity_id
          targetType: attribute
          targetFormat: integer
          preserveSource: false
          overrideOnConflict: false
        - type: string-builder-processor
          name: Add category uid
          enabled: true
          template: "3"
          target: ocsf.category_uid
          replaceMissing: false
        - type: string-builder-processor
          name: Add category name
          enabled: true
          template: "Identity & Access Management"
          target: ocsf.category_name
          replaceMissing: false
        - type: string-builder-processor
          name: Add class uid
          enabled: true
          template: "3001"
          target: ocsf.class_uid
          replaceMissing: false
        - type: string-builder-processor
          name: Add class name
          enabled: true
          template: "Account Change"
          target: ocsf.class_name
          replaceMissing: false
        - type: category-processor
          name: status_id
          enabled: true
          categories:
            - filter:
                query: "@ocsf.metadata.event_code:(s* OR organization_member_added)"
              name: "1"
            - filter:
                query: "@ocsf.metadata.event_code:(f* OR gd_otp_rate_limit_exceed)"
              name: "2"
          target: ocsf.status_id
        - type: category-processor
          name: status_name
          enabled: true
          categories:
            - filter:
                query: "@ocsf.metadata.event_code:(s* OR organization_member_added)"
              name: "Success"
            - filter:
                query: "@ocsf.metadata.event_code:(f* OR gd_otp_rate_limit_exceed)"
              name: "Failure"
          target: ocsf.status
        - type: attribute-remapper
          name: Map `ocsf.status_id` to `ocsf.status_id`
          enabled: true
          sources:
            - ocsf.status_id
          sourceType: attribute
          target: ocsf.status_id
          targetType: attribute
          targetFormat: integer
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `data.user_id` to `ocsf.user.uid`
          enabled: true
          sources:
            - data.user_id
          sourceType: attribute
          target: ocsf.user.uid
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: grok-parser
          name: Add user id
          enabled: true
          source: message
          samples:
            - "user_id: x7k9m2p4q5r8t3v6w1y0z9a2b4c6d8e"
            - "user_id: ef187c9e-0de6-423a-9632-8da800e2f020"
          grok:
            supportRules: ""
            matchRules: "parse_user_id user_id: %{notSpace:ocsf.user.uid}"
        - type: attribute-remapper
          name: Map `data.user_name` to `ocsf.user.name`
          enabled: true
          sources:
            - data.user_name
          sourceType: attribute
          target: ocsf.user.name
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
    # OCSF Authentication [3002] pipeline
    - type: pipeline
      name: Auth0 OCSF sub pipeline for class Authentication [3002]
      enabled: true
      ocsf:
        isOcsf: true
      filter:
        query: "@ocsf.metadata.event_code:(ciba_exchange_failed OR ciba_exchange_succeeded OR ciba_start_failed OR ciba_start_succeeded OR cls OR cs OR f OR fc OR fco OR fcoa OR fd OR feacft OR feccft OR fecte OR fede OR federated_logout_failed OR fens OR feoobft OR feotpft OR fepft OR fepotpft OR fercft OR ferrt OR fertft OR fi OR flo OR fp OR fpar OR fpurh OR fs OR fsa OR fu OR fv OR fvr OR gd_auth_email_verification OR gd_auth_failed OR gd_auth_rejected OR gd_auth_succeed OR gd_enrollment_complete OR gd_recovery_failed OR gd_recovery_rate_limit_exceed OR gd_recovery_succeed OR gd_send_email OR gd_send_email_verification OR gd_send_email_verification_failure OR gd_send_pn OR gd_send_pn_failure OR gd_send_sms OR gd_send_sms_failure OR gd_send_voice OR gd_send_voice_failure OR gd_start_auth OR gd_start_enroll OR gd_start_enroll_failed OR gd_unenroll OR gd_webauthn_challenge_failed OR limit_mu OR limit_sul OR limit_wc OR mfar OR oidc_backchannel_logout_failed OR oidc_backchannel_logout_succeeded OR passkey_challenge_failed OR passkey_challenge_started OR pla OR pwd_leak OR reset_pwd_leak OR s OR scoa OR scv OR sd OR seacft OR seccft OR secte OR sede OR sens OR seoobft OR seotpft OR sepft OR sepkoobft OR sepkotpft OR sepkrcft OR sercft OR sertft OR si OR signup_pwd_leak OR slo OR srrt OR ss OR ss_sso_failure OR ss_sso_info OR ss_sso_success OR ssa OR sv OR svr OR universal_logout_failed OR universal_logout_succeeded OR w)"
      processors:
        - type: attribute-remapper
          name: Map `data.type` to `ocsf.activity_name`
          enabled: true
          sources:
            - data.type
          sourceType: attribute
          target: ocsf.activity_name
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: category-processor
          name: activity_id
          enabled: true
          categories:
            - filter:
                query: "@ocsf.metadata.event_code:(f OR fp OR fu OR limit_mu OR limit_sul OR limit_wc OR s OR w)"
              name: "1"
            - filter:
                query: "@ocsf.metadata.event_code:(federated_logout_failed OR flo OR oidc_backchannel_logout_failed OR oidc_backchannel_logout_succeeded OR slo OR universal_logout_failed OR universal_logout_succeeded)"
              name: "2"
            - filter:
                query: "@ocsf.metadata.event_code:*"
              name: "99"
          target: ocsf.activity_id
        - type: category-processor
          name: activity_name
          enabled: true
          categories:
            - filter:
                query: "@ocsf.metadata.event_code:(f OR fp OR fu OR limit_mu OR limit_sul OR limit_wc OR s OR w)"
              name: "Logon"
            - filter:
                query: "@ocsf.metadata.event_code:(federated_logout_failed OR flo OR oidc_backchannel_logout_failed OR oidc_backchannel_logout_succeeded OR slo OR universal_logout_failed OR universal_logout_succeeded)"
              name: "Logoff"
          target: ocsf.activity_name
        - type: attribute-remapper
          name: Map `ocsf.activity_id` to `ocsf.activity_id`
          enabled: true
          sources:
            - ocsf.activity_id
          sourceType: attribute
          target: ocsf.activity_id
          targetType: attribute
          targetFormat: integer
          preserveSource: false
          overrideOnConflict: false
        - type: string-builder-processor
          name: Add category uid
          enabled: true
          template: "3"
          target: ocsf.category_uid
          replaceMissing: false
        - type: string-builder-processor
          name: Add category name
          enabled: true
          template: "Identity & Access Management"
          target: ocsf.category_name
          replaceMissing: false
        - type: string-builder-processor
          name: Add class uid
          enabled: true
          template: "3002"
          target: ocsf.class_uid
          replaceMissing: false
        - type: string-builder-processor
          name: Add class name
          enabled: true
          template: "Authentication"
          target: ocsf.class_name
          replaceMissing: false
        - type: category-processor
          name: status_id
          enabled: true
          categories:
            - filter:
                query: "@ocsf.metadata.event_code:(ciba_exchange_succeeded OR ciba_start_succeeded OR cls OR cs OR gd_auth_email_verification OR gd_auth_succeed OR gd_enrollment_complete OR gd_recovery_succeed OR gd_send_email OR gd_send_email_verification OR gd_send_pn OR gd_send_sms OR gd_send_voice OR gd_start_auth OR gd_start_enroll OR gd_unenroll OR oidc_backchannel_logout_succeeded OR passkey_challenge_started OR s OR scoa OR scv OR sd OR seacft OR seccft OR secte OR sede OR sens OR seoobft OR seotpft OR sepft OR sepkoobft OR sepkotpft OR sepkrcft OR sercft OR sertft OR si OR slo OR srrt OR ss OR ss_sso_success OR ssa OR sv OR svr OR too_many_records OR universal_logout_succeeded)"
              name: "1"
            - filter:
                query: "@ocsf.metadata.event_code:(ciba_exchange_failed OR ciba_start_failed OR f OR fc OR fco OR fcoa OR fd OR feacft OR feccft OR fecte OR fede OR federated_logout_failed OR fens OR feoobft OR feotpft OR fepft OR fepotpft OR fercft OR ferrt OR fertft OR fi OR flo OR fp OR fpar OR fpurh OR fs OR fsa OR fu OR fv OR fvr OR gd_auth_failed OR gd_recovery_failed OR gd_recovery_rate_limit_exceed OR gd_send_email_verification_failure OR gd_send_pn_failure OR gd_send_sms_failure OR gd_send_voice_failure OR gd_start_enroll_failed OR gd_webauthn_challenge_failed OR limit_mu OR limit_sul OR limit_wc OR oidc_backchannel_logout_failed OR passkey_challenge_failed OR ss_sso_failure OR universal_logout_failed)"
              name: "2"
          target: ocsf.status_id
        - type: category-processor
          name: status_name
          enabled: true
          categories:
            - filter:
                query: "@ocsf.metadata.event_code:(ciba_exchange_succeeded OR ciba_start_succeeded OR cls OR cs OR gd_auth_email_verification OR gd_auth_succeed OR gd_enrollment_complete OR gd_recovery_succeed OR gd_send_email OR gd_send_email_verification OR gd_send_pn OR gd_send_sms OR gd_send_voice OR gd_start_auth OR gd_start_enroll OR gd_unenroll OR oidc_backchannel_logout_succeeded OR passkey_challenge_started OR s OR scoa OR scv OR sd OR seacft OR seccft OR secte OR sede OR sens OR seoobft OR seotpft OR sepft OR sepkoobft OR sepkotpft OR sepkrcft OR sercft OR sertft OR si OR slo OR srrt OR ss OR ss_sso_success OR ssa OR sv OR svr OR too_many_records OR universal_logout_succeeded)"
              name: "Success"
            - filter:
                query: "@ocsf.metadata.event_code:(ciba_exchange_failed OR ciba_start_failed OR f OR fc OR fco OR fcoa OR fd OR feacft OR feccft OR fecte OR fede OR federated_logout_failed OR fens OR feoobft OR feotpft OR fepft OR fepotpft OR fercft OR ferrt OR fertft OR fi OR flo OR fp OR fpar OR fpurh OR fs OR fsa OR fu OR fv OR fvr OR gd_auth_failed OR gd_recovery_failed OR gd_recovery_rate_limit_exceed OR gd_send_email_verification_failure OR gd_send_pn_failure OR gd_send_sms_failure OR gd_send_voice_failure OR gd_start_enroll_failed OR gd_webauthn_challenge_failed OR limit_mu OR limit_sul OR limit_wc OR oidc_backchannel_logout_failed OR passkey_challenge_failed OR ss_sso_failure OR universal_logout_failed)"
              name: "Failure"
          target: ocsf.status
        - type: attribute-remapper
          name: Map `ocsf.status_id` to `ocsf.status_id`
          enabled: true
          sources:
            - ocsf.status_id
          sourceType: attribute
          target: ocsf.status_id
          targetType: attribute
          targetFormat: integer
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `data.user_id` to `ocsf.user.uid`
          enabled: true
          sources:
            - data.user_id
          sourceType: attribute
          target: ocsf.user.uid
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `data.user_name` to `ocsf.user.name`
          enabled: true
          sources:
            - data.user_name
          sourceType: attribute
          target: ocsf.user.name
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `data.hostname` to `ocsf.dst_endpoint.hostname`
          enabled: true
          sources:
            - data.hostname
          sourceType: attribute
          target: ocsf.dst_endpoint.hostname
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
    # OCSF API Activity [6003] pipeline
    - type: pipeline
      name: Auth0 OCSF sub pipeline for class API Activity [6003]
      enabled: true
      ocsf:
        isOcsf: true
      filter:
        query: "-@ocsf.category_uid:*"
      processors:
        - type: attribute-remapper
          name: Map `data.type` to `ocsf.activity_name`
          enabled: true
          sources:
            - data.type
          sourceType: attribute
          target: ocsf.activity_name
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: category-processor
          name: activity_id
          enabled: true
          categories:
            - filter:
                query: "@ocsf.http_request.http_method:POST"
              name: "1"
            - filter:
                query: "@ocsf.http_request.http_method:GET"
              name: "2"
            - filter:
                query: "@ocsf.http_request.http_method:PUT"
              name: "3"
            - filter:
                query: "@ocsf.http_request.http_method:DELETE"
              name: "4"
            - filter:
                query: "@ocsf.metadata.event_code:*"
              name: "99"
          target: ocsf.activity_id
        - type: category-processor
          name: activity_name
          enabled: true
          categories:
            - filter:
                query: "@ocsf.http_request.http_method:POST"
              name: "Create"
            - filter:
                query: "@ocsf.http_request.http_method:GET"
              name: "Read"
            - filter:
                query: "@ocsf.http_request.http_method:PUT"
              name: "Update"
            - filter:
                query: "@ocsf.http_request.http_method:DELETE"
              name: "Delete"
          target: ocsf.activity_name
        - type: attribute-remapper
          name: Map `ocsf.activity_id` to `ocsf.activity_id`
          enabled: true
          sources:
            - ocsf.activity_id
          sourceType: attribute
          target: ocsf.activity_id
          targetType: attribute
          targetFormat: integer
          preserveSource: false
          overrideOnConflict: false
        - type: string-builder-processor
          name: Add category uid
          enabled: true
          template: "6"
          target: ocsf.category_uid
          replaceMissing: false
        - type: string-builder-processor
          name: Add category name
          enabled: true
          template: "Application Activity"
          target: ocsf.category_name
          replaceMissing: false
        - type: string-builder-processor
          name: Add class uid
          enabled: true
          template: "6003"
          target: ocsf.class_uid
          replaceMissing: false
        - type: string-builder-processor
          name: Add class name
          enabled: true
          template: "API Activity"
          target: ocsf.class_name
          replaceMissing: false
        - type: category-processor
          name: status_id
          enabled: true
          categories:
            - filter:
                query: "@ocsf.metadata.event_code:(appi OR fdecc OR flows_execution_completed OR forms_submission_succeeded OR gd_tenant_update OR gd_update_device_account OR kms_key_management_success OR kms_key_state_changed OR mgmt_api_read OR resource_cleanup OR sscim OR sui OR ublkdu)"
              name: "1"
            - filter:
                query: "@ocsf.metadata.event_code:(actions_execution_failed OR fcpro OR fdeac OR fdeaz OR flows_execution_failed OR fn OR forms_submission_failed OR fui OR gd_auth_fail_email_verification OR gd_webauthn_enrollment_failed OR kms_key_management_failure OR limit_delegation OR rich_consents_access_error)"
              name: "2"
          target: ocsf.status_id
        - type: category-processor
          name: status_name
          enabled: true
          categories:
            - filter:
                query: "@ocsf.metadata.event_code:(appi OR fdecc OR flows_execution_completed OR forms_submission_succeeded OR gd_tenant_update OR gd_update_device_account OR kms_key_management_success OR kms_key_state_changed OR mgmt_api_read OR resource_cleanup OR sscim OR sui OR ublkdu)"
              name: "Success"
            - filter:
                query: "@ocsf.metadata.event_code:(actions_execution_failed OR fcpro OR fdeac OR fdeaz OR flows_execution_failed OR fn OR forms_submission_failed OR fui OR gd_auth_fail_email_verification OR gd_webauthn_enrollment_failed OR kms_key_management_failure OR limit_delegation OR rich_consents_access_error)"
              name: "Failure"
          target: ocsf.status
        - type: attribute-remapper
          name: Map `ocsf.status_id` to `ocsf.status_id`
          enabled: true
          sources:
            - ocsf.status_id
          sourceType: attribute
          target: ocsf.status_id
          targetType: attribute
          targetFormat: integer
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `data.type` to `ocsf.api.operation`
          enabled: true
          sources:
            - data.type
          sourceType: attribute
          target: ocsf.api.operation
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `data.details.request` to `ocsf.api.request.data`
          enabled: true
          sources:
            - data.details.request
          sourceType: attribute
          target: ocsf.api.request.data
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `data.details.response` to `ocsf.api.response.data`
          enabled: true
          sources:
            - data.details.response
          sourceType: attribute
          target: ocsf.api.response.data
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: string-builder-processor
          name: Add api.request.uid
          enabled: true
          template: "unknown"
          target: ocsf.api.request.uid
          replaceMissing: false
    # OCSF post-transformations
    - type: pipeline
      name: OCSF post transformations
      enabled: true
      ocsf:
        isOcsf: true
      filter:
        query: "*"
      processors:
        - type: attribute-remapper
          name: Map `ocsf.category_uid` to `ocsf.category_uid`
          enabled: true
          sources:
            - ocsf.category_uid
          sourceType: attribute
          target: ocsf.category_uid
          targetType: attribute
          targetFormat: integer
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `ocsf.class_uid` to `ocsf.class_uid`
          enabled: true
          sources:
            - ocsf.class_uid
          sourceType: attribute
          target: ocsf.class_uid
          targetType: attribute
          targetFormat: integer
          preserveSource: false
          overrideOnConflict: false
        - type: string-builder-processor
          name: Add severity
          enabled: true
          template: "Informational"
          target: ocsf.severity
          replaceMissing: false
        - type: string-builder-processor
          name: Add severity id
          enabled: true
          template: "1"
          target: ocsf.severity_id
          replaceMissing: false
        - type: attribute-remapper
          name: Map `ocsf.severity_id` to `ocsf.severity_id`
          enabled: true
          sources:
            - ocsf.severity_id
          sourceType: attribute
          target: ocsf.severity_id
          targetType: attribute
          targetFormat: integer
          preserveSource: false
          overrideOnConflict: false
        - type: arithmetic-processor
          name: Type ID calculator
          enabled: true
          expression: (ocsf.class_uid * 100) + ocsf.activity_id
          target: ocsf.type_uid_float
          replaceMissing: false
        - type: attribute-remapper
          name: Map `ocsf.type_uid_float` to `ocsf.type_uid`
          enabled: true
          sources:
            - ocsf.type_uid_float
          sourceType: attribute
          target: ocsf.type_uid
          targetType: attribute
          targetFormat: integer
          preserveSource: false
          overrideOnConflict: false
