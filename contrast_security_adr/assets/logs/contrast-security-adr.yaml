id: contrast-security-adr
# See app_id in your integration's manifest.json file to learn more:
# https://docs.datadoghq.com/developers/integrations/check_references/#manifest-file
metric_id: contrast-security-adr
# If for some reason id must be different than app_id, add the app_id in this field instead.
# If id and app_id already match, this field can be left blank.
backend_only: false
facets:
  - groups:
      - Web Access
    name: Method
    path: http.method
    source: log
  - groups:
      - Web Access
    name: URL scheme
    path: http.url_details.scheme
    source: log
  - groups:
      - Web Access
    name: Version
    path: http.version
    source: log
  - groups:
      - Event
    name: Event Outcome
    path: evt.outcome
    source: log
  - groups:
      - Web Access
    name: URL Path
    path: http.url_details.path
    source: log
  - groups:
      - Web Access
    name: Referer
    path: http.referer
    source: log
  - groups:
      - Web Access
    name: URL Host
    path: http.url_details.host
    source: log
  - groups:
      - Event
    name: Event Name
    path: evt.name
    source: log
  - groups:
      - Web Access
    name: OS
    path: http.useragent_details.os.family
    source: log
  - description: ""
    facetType: list
    groups:
      - Contrast ADR - Incident
    name: contrast_adr.incident_id
    path: contrast_adr.incident_id
    source: log
    type: string
pipeline:
  type: pipeline
  name: Contrast ADR Pipeline
  enabled: true
  filter:
    query: source:contrast-security-adr
  processors:
    - type: pipeline
      name: Contrast ADR Incidents
      enabled: true
      filter:
        query: "@incidentid:*"
      processors:
        - type: attribute-remapper
          name: "Remapper: Map `score` to `syslog.severity`"
          enabled: true
          sources:
            - score
          sourceType: attribute
          target: syslog.severity
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: attribute-remapper
          name: "Remapper: Map `url` to `resource.url`"
          enabled: true
          sources:
            - url
          sourceType: attribute
          target: resource.url
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: attribute-remapper
          name: "Remapper: Map `createdTime` to `date`"
          enabled: true
          sources:
            - createdTime
          sourceType: attribute
          target: date
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: date-remapper
          name: "Date Remapper: 'date' as date of the log"
          enabled: true
          sources:
            - date
        - type: attribute-remapper
          name: "Remapper: Map `eventType` to `resource.type`"
          enabled: true
          sources:
            - eventType
          sourceType: attribute
          target: resource.type
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: status-remapper
          name: "Status Remapper: Map `severity`"
          enabled: true
          sources:
            - severity
    - type: pipeline
      name: Contrast ADR Attack Events
      enabled: true
      filter:
        query: "@eventUuid:*"
      processors:
        - type: attribute-remapper
          name: "Remapper: Map `sourceIp` to `network.host.ip`"
          enabled: true
          sources:
            - sourceIp
          sourceType: attribute
          target: network.host.ip
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: attribute-remapper
          name: "Remapper : Map `sevirity` to `status`"
          enabled: true
          sources:
            - sevirity
          sourceType: attribute
          target: status
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: attribute-remapper
          name: " Remapper: Map `request.method` to `http.method`"
          enabled: true
          sources:
            - request.method
          sourceType: attribute
          target: http.method
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: attribute-remapper
          name: "Remapper: Map `request.protocol` to `http.url_details.scheme`"
          enabled: true
          sources:
            - request.protocol
          sourceType: attribute
          target: http.url_details.scheme
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: attribute-remapper
          name: "Remapper: Map `request.queryString` to `http.url_details.queryString`"
          enabled: true
          sources:
            - request.queryString
          sourceType: attribute
          target: http.url_details.queryString
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: attribute-remapper
          name: "Remapper: Map `request.protocolVersion` to `http.version`"
          enabled: true
          sources:
            - request.protocolVersion
          sourceType: attribute
          target: http.version
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: date-remapper
          name: "Remapper: Map `date` as the date of log"
          enabled: true
          sources:
            - date
        - type: attribute-remapper
          name: "Remapper: Map 'detectedTime' to  'date'"
          enabled: true
          sources:
            - detectedTime
          sourceType: attribute
          target: date
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: attribute-remapper
          name: "Remapper: Map `result` to `evt.outcome`"
          enabled: true
          sources:
            - result
          sourceType: attribute
          target: evt.outcome
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: url-parser
          name: "URL Parser : Map `apiUri` to `http.url_details.path`"
          enabled: true
          sources:
            - apiUri
          target: http.url_details.path
          normalizeEndingSlashes: false
        - type: attribute-remapper
          name: "Remapper: Map `request.headers.referer` to `http.referer`"
          enabled: true
          sources:
            - request.headers.referer
          sourceType: attribute
          target: http.referer
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: attribute-remapper
          name: "Remapper: Map `request.headers.host` to `http.url_details.host`"
          enabled: true
          sources:
            - request.headers.host
          sourceType: attribute
          target: http.url_details.host
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: attribute-remapper
          name: "Remapper: Map `request.headers` to `http.request.headers`"
          enabled: true
          sources:
            - request.headers
          sourceType: attribute
          target: http.request.headers
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: attribute-remapper
          name: "Remapper : Map `request.headers.user-agent` to `http.user-agent`"
          enabled: true
          sources:
            - request.headers.user-agent
          sourceType: attribute
          target: http.user-agent
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: attribute-remapper
          name: "Remapper: Map `rule` to `evt.name`"
          enabled: true
          sources:
            - rule
          sourceType: attribute
          target: evt.name
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: attribute-remapper
          name: "Remapper: Map `host.operatingSystem` to
            `http.useragent_details.os.family`"
          enabled: true
          sources:
            - host.operatingSystem
          sourceType: attribute
          target: http.useragent_details.os.family
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: attribute-remapper
          name: "Remapper: Map `host.hostname` to `network.host.name`"
          enabled: true
          sources:
            - host.hostname
          sourceType: attribute
          target: network.host.name
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: attribute-remapper
          name: "Remapper: Map `agentVersion` to `version`"
          enabled: true
          sources:
            - agentVersion
          sourceType: attribute
          target: version
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: attribute-remapper
          name: "Remapper: Map `incident_id` to `contrast_adr.incident_id`"
          enabled: true
          sources:
            - incident_id
          sourceType: attribute
          target: contrast_adr.incident_id
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
