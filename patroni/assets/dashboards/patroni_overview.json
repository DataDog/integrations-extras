{"title":"patroni","description":null,"widgets":[{"id":7430822203011234,"definition":{"type":"image","url":"https://image.nostr.build/7263995b464a3eb3e24124fa8b9b741e71d8b6b4c8308b078a3d59b01796cc88.png","sizing":"contain","margin":"md","has_background":false,"has_border":false,"vertical_align":"center","horizontal_align":"center"},"layout":{"x":0,"y":0,"width":4,"height":2}},{"id":2539920249723822,"definition":{"type":"note","content":"The Patroni Datadog Integration provides comprehensive monitoring for PostgreSQL clusters managed by Patroni. It tracks key metrics like node health, leader status, replication lag, and failover events, ensuring high availability and visibility into your cluster's performance. The integration enables real-time alerts for failovers and replication issues, while also collecting configuration metrics to monitor cluster settings, helping maintain optimal performance and stability.","background_color":"vivid_blue","font_size":"14","text_align":"left","vertical_align":"center","show_tick":true,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":4,"y":0,"width":4,"height":2}},{"id":8442496911374558,"definition":{"title":"Service checks","background_color":"vivid_green","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":67078799847168,"definition":{"title":"Config check","title_size":"16","title_align":"left","type":"check_status","check":"patroni.openmetrics.health","grouping":"cluster","group_by":["endpoint"],"tags":[]},"layout":{"x":0,"y":0,"width":2,"height":2}},{"id":2567628852812980,"definition":{"title":"Cluster check","title_size":"16","title_align":"left","type":"check_status","check":"patroni.cluster.check","grouping":"cluster","group_by":[],"tags":[]},"layout":{"x":4,"y":0,"width":2,"height":2}}]},"layout":{"x":0,"y":2,"width":12,"height":3}},{"id":8864854196702302,"definition":{"title":"Leader status","background_color":"vivid_green","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":684217196972856,"definition":{"title":"Patroni leader","title_size":"16","title_align":"left","type":"query_table","requests":[{"queries":[{"data_source":"metrics","name":"query1","query":"sum:patroni.primary{*} by {name}.fill(zero).rollup(sum, 15)","aggregator":"last"}],"response_format":"scalar","sort":{"count":500,"order_by":[{"type":"formula","index":0,"order":"desc"}]},"formulas":[{"cell_display_mode":"number","conditional_formats":[{"comparator":">","value":0,"palette":"white_on_green"},{"comparator":"<","value":1,"palette":"yellow_on_white"}],"formula":"cutoff_min(query1, 1)"}]}],"has_search_bar":"auto"},"layout":{"x":0,"y":0,"width":4,"height":2}},{"id":2945986351214600,"definition":{"title":"Patroni leader","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"name":"query1","data_source":"metrics","query":"sum:patroni.primary{*} by {name}.fill(null)"}],"response_format":"timeseries","style":{"palette":"dog_classic","order_by":"values","order_reverse":false,"line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":4,"y":0,"width":4,"height":2}},{"id":7223400988412302,"definition":{"title":"Leader Running","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"cutoff_min(query1, 1)"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:patroni.cluster.role.leader{state:running} by {state,name}.fill(null)"}],"response_format":"timeseries","style":{"palette":"dog_classic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":8,"y":0,"width":4,"height":2}}]},"layout":{"x":0,"y":5,"width":12,"height":3}},{"id":2022008751468964,"definition":{"title":"Replica status","background_color":"vivid_green","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":1869417711830344,"definition":{"title":"Patroni replica","title_size":"16","title_align":"left","type":"query_table","requests":[{"queries":[{"data_source":"metrics","name":"query1","query":"max:patroni.replica{*} by {name,endpoint}","aggregator":"last"}],"response_format":"scalar","sort":{"count":500,"order_by":[{"type":"formula","index":0,"order":"desc"}]},"formulas":[{"cell_display_mode":"number","conditional_formats":[{"comparator":">","value":0,"palette":"white_on_green"},{"comparator":"=","value":0,"palette":"yellow_on_white"}],"formula":"query1"}]}],"has_search_bar":"auto"},"layout":{"x":0,"y":0,"width":4,"height":3}},{"id":4015738104725812,"definition":{"title":"Replica streaming","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:patroni.postgres.streaming{*} by {name}"}],"response_format":"timeseries","style":{"palette":"dog_classic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":4,"y":0,"width":4,"height":2}}]},"layout":{"x":0,"y":8,"width":12,"height":4}},{"id":8942710091957508,"definition":{"title":"Failover","background_color":"vivid_green","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":3173153223024496,"definition":{"title":"Patroni failover events","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"data_source":"events","name":"query1","indexes":["*"],"compute":{"aggregation":"count"},"group_by":[{"facet":"new_leader","limit":10,"sort":{"order":"desc","aggregation":"count"}}],"search":{"query":"new_leader:*"}}],"response_format":"timeseries","style":{"palette":"dog_classic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":0,"y":0,"width":4,"height":3}},{"id":2495153286114712,"definition":{"title":"patroni failover monitors","type":"manage_status","display_format":"countsAndList","color_preference":"text","hide_zero_counts":true,"show_status":true,"last_triggered_format":"relative","query":"patroni","sort":"status,asc","count":50,"start":0,"summary_type":"monitors","show_priority":false,"show_last_triggered":false},"layout":{"x":4,"y":0,"width":4,"height":3}},{"id":4621706728375622,"definition":{"title":"Stopped nodes","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"},{"formula":"query2"}],"queries":[{"data_source":"metrics","name":"query1","query":"avg:patroni.cluster.role.leader{state:stopped, $node} by {node}"},{"data_source":"metrics","name":"query2","query":"avg:patroni.cluster.role.replica{state:stopped, $node} by {node}"}],"response_format":"timeseries","style":{"palette":"dog_classic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":8,"y":0,"width":4,"height":3}}]},"layout":{"x":0,"y":12,"width":12,"height":4,"is_column_break":true}},{"id":6433497573026708,"definition":{"title":"Lag","background_color":"vivid_orange","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":4773747351793264,"definition":{"title":"Cluster Member Lag","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"data_source":"metrics","name":"query1","query":"avg:patroni.cluster.member.lag{*} by {name}"}],"response_format":"timeseries","style":{"palette":"dog_classic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":0,"y":0,"width":4,"height":2}},{"id":7701145506832840,"definition":{"title":"DCS last seen","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"autosmooth(exclude_null(query1))"}],"queries":[{"data_source":"metrics","name":"query1","query":"avg:patroni.dcs_last_seen_diff{*} by {name}"}],"response_format":"timeseries","style":{"palette":"dog_classic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":4,"y":0,"width":4,"height":2}}]},"layout":{"x":0,"y":16,"width":12,"height":3}},{"id":5960610231551056,"definition":{"title":"","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"data_source":"metrics","name":"query1","query":"avg:patroni.postgres.running{*} by {name}"}],"response_format":"timeseries","style":{"palette":"dog_classic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":0,"y":0,"width":4,"height":2}},{"id":8576429742463436,"definition":{"title":"","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"data_source":"metrics","name":"query1","query":"max:patroni.postgres.streaming{*} by {name}"}],"response_format":"timeseries","style":{"palette":"dog_classic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":4,"y":0,"width":4,"height":2}},{"id":1242201152000370,"definition":{"title":"","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"data_source":"metrics","name":"query1","query":"avg:patroni.is_paused{*} by {name}"}],"response_format":"timeseries","style":{"palette":"dog_classic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":8,"y":0,"width":4,"height":2}},{"id":3262012141778306,"definition":{"title":"","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"data_source":"metrics","name":"query1","query":"avg:patroni.cluster.unlocked{*} by {name}"}],"response_format":"timeseries","style":{"palette":"dog_classic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":0,"y":2,"width":4,"height":2}},{"id":4585094656248780,"definition":{"title":"","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"data_source":"metrics","name":"query1","query":"avg:patroni.quorum_standby{*} by {name}"}],"response_format":"timeseries","style":{"palette":"dog_classic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":4,"y":2,"width":4,"height":2}},{"id":1021811918936736,"definition":{"title":"","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:patroni.cluster.member.timeline{*} by {name}"}],"response_format":"timeseries","style":{"palette":"dog_classic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":8,"y":2,"width":4,"height":2}},{"id":264924338949946,"definition":{"title":"Timeline increase","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:patroni.postgres.timeline.count{*} by {name}.as_count()"}],"response_format":"timeseries","style":{"palette":"dog_classic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":0,"y":4,"width":4,"height":2}}],"template_variables":[{"name":"node","prefix":"node","available_values":[],"default":"*"},{"name":"state","prefix":"state","available_values":[],"default":"*"}],"layout_type":"ordered","notify_list":[],"reflow_type":"fixed"}